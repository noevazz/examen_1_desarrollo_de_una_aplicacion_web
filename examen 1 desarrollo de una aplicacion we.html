<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen 1</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>

    <div class="container">
        <div class="form-group">
            <h1>Captura de registros</h1>
            <h2 class="text-center"><strong id="ruleta">0 de 0</strong></h2>

            <label for="name">Nombre del virus</label> <br>
            <input class="" type="text" id="name_input">
            <br>
            
            <label for="img_url">URL de la imagen</label> <br>
            <input class="" type="text" id="img_url_input">
            <br>
            
            <label for="biography">Biografia</label> <br>
            <input class="" type="text" id="biography_input">
            <br>

            <label for="origin">Origen</label> <br>
            <input class="" type="text" id="origin_input">
            <br> <br>
            <button type="button" class="btn btn-outline-dark mb-1" id="new_virus_and_save" onclick="new_virus_and_save_action()">Nuevo</button>
            <button type="button" class="btn btn-outline-dark mb-1" id="edit" onclick="edit_current_virus()">Editar</button>
            <button type="button" class="btn btn-outline-dark mb-1" id="delete" onclick="delete_current_virus()">Eliminar</button>
            <br>
            <button type="button" class="btn btn-outline-dark mb-1" id="first" onclick="go_to_first()">Primero</button>
            <button type="button" class="btn btn-outline-dark mb-1" id="next" onclick="go_to_next()">Siguiente</button>
            <button type="button" class="btn btn-outline-dark mb-1" id="previous" onclick="go_to_previous()">Anterior</button>
            <button type="button" class="btn btn-outline-dark mb-1" id="last" onclick="go_to_last()">Último</button>
            <br>
            <div class="btn-group">
                <button id="search_field" type="button" class="btn btn-outline-dark dropdown-toggle" data-toggle="dropdown">
                Campo
                </button>
                <div class="dropdown-menu">
                  <a id="name_search" class="dropdown-item" href="#" onclick="set_field(this)">Nombre</a>
                  <a id="img_url_search" class="dropdown-item" href="#" onclick="set_field(this)">URL</a>
                  <a id="biography_search" class="dropdown-item" href="#" onclick="set_field(this)">Biografia</a>
                  <a id="origin_search" class="dropdown-item" href="#" onclick="set_field(this)">Origen</a>
                </div>
            </div>
            <script>
                function set_field(e) {
                    console.log(e.id);
                    var update_search_field_with_this = "";
                    switch (e.id){
                        case "name_search": 
                            update_search_field_with_this = "Nombre";
                            break;
                        case "img_url_search": 
                            update_search_field_with_this = "URL";
                            break;
                        case "biography_search": 
                            update_search_field_with_this = "Biografia";
                            break;
                        case "origin_search": 
                            update_search_field_with_this = "Origen";
                            break;
                    }
                    document.getElementById("search_field").innerHTML = update_search_field_with_this
                }
            </script>
            <input class="" type="text" id="search_text">
            <button type="button" class="btn btn-outline-dark mb-1" id="search_button">Buscar</button>

        </div>
    </div>
    <div class="container">
        <h2>Requisitos del examen</h2>
        <div class="list-group">
            <li class="list-group-item list-group-item-action">
            ✅ I. Al presionar el botón de Nuevo se deben de limpiar todos los campos, y
            cambiar el botón a Guardar, cuando el botón sea Guardar agregar el registro
            y mostrarlo en pantalla (Siempre será el último registro), además de actualizar
            el estatus de la barra que indica en que registro se esta del total de registros, y
            cambiar de nuevo el botón para que diga Nuevo.
            
            <li class="list-group-item list-group-item-action">
            II. El botón de Editar te permite al presionarlo poner en edición el registro y
            cambiar el botón de Editar a Guardar, si presionas el botón de edición cuando
            esta en el modo de Guardar debe hacer el cambio en el registro que se esta
            editando, y regresar el botón a la vista de Editar, claro poniendo todos los
            campos en modo readonly par que no se puedan modificar.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ III. El botón de Eliminar elimina el registro donde estas posicionado, el que se
            muestra en pantalla.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ IV. El botón Primero se va al primer registro.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ V. El botón Siguiente se va al siguiente registro en el vector, siempre y cuando
            no se encuentre ya en el último.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ VI. El botón Anterior se va al registro anterior registro en el vector, siempre y
            cuando no se encuentre ya en el primero.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ VII. El botón de Ultimo se va al ultimo registro que se encuentra en el vector.
            </li>

            <li class="list-group-item list-group-item-action">
            VIII. En el botón de Buscar hay que seleccionar de la lista en cual campo se desea
            buscar, siguiente introducir el texto a buscar en ese campo, si lo encuentra
            posicionarse en el primero que encontró con ese contenido encontrado en ese
            campo, si no indicar que no se encontró información alguna.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ IX. Con la función JSON.stringify() convierte todo el vector en una cadena y
            guárdalo en utilizando los métodos de localstorage, y con JSON.parse()
            cargarlo de localstorage y conviértelo a vector de objetos de nuevo, Con la
            finalidad de que queden guardados todos los registros y poderlos recuperar
            también.
            </li>
        </div>
    </div>

    <script src="./web_storage_code.js"></script>
    <script>
        
        
        for (v of $get_viruses_only_names()){
            console.log(delete_virus(v));
            console.log("nombre ", v)
        }
        $add_virus(name="Ébola",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/nino_africano_de_burundi_2_ebola.jpg?itok=odgmGJoT",
		biography ="El ébola no se transmite por el aire, sino a través del contacto con animales infectados o por el contacto de fluidos corporales de personas.",
		origin = "África Occidental");

		$add_virus(name = "Malaria",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/malaria.jpg?itok=5Z0ih-at",
		biography ="Se transmite por la picadura del mosquito Anopheles.",
		origin = "África subsahariana");

		$add_virus(name = "Dengue",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/malaria.jpg?itok=5Z0ih-at",
		biography ="Se trata de una infección vírica transmitida por mosquitos que se presenta en los climas tropicales y subtropicales de todo el planeta, sobre todo en las zonas urbanas y semiurbanas.",
		origin = "África subsahariana");

		$add_virus(name = "Sarampión",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/rf187423_077961_web_0.jpg?itok=PwAa9GjT",
		biography ="Enfermedad infecciosa y contagiosa, causada por un virus, que se caracteriza por la aparición de pequeñas manchas rojas en la piel, fiebre alta y síntomas catarrales; generalmente, se padece durante la infancia.",
		origin ="Colima");

		$add_virus(name = "Sarampión2",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/rf187423_077961_web_0.jpg?itok=PwAa9GjT",
		biography = "Enfermedad infecciosa y contagiosa, causada por un virus, que se caracteriza por la aparición de pequeñas manchas rojas en la piel, fiebre alta y síntomas catarrales; generalmente, se padece durante la infancia.",
		origin = "Colima");

		$add_virus(name = "SIDA",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/vih.jpg?itok=gZSxkp66",
		biography = "El virus se transmite por vía sexual, a través de transfusiones de sangre contaminada, por el uso compartido de materiales quirúrgicos contaminados, o de madre a hijo durante el embarazo, el parto o la lactancia.",
		origin = "África");

		$add_virus(name = "COVID-19",
		img_url = "https://www.coyoacan.cdmx.gob.mx/imgcovid/covid4.jpg",
		biography = "El coronavirus es un grupo de virus que causan enfermedades que van desde el resfriado común hasta enfermedades más graves.",
		origin = "Wuhan, en China");


        // Obtener todos los virus: 
        console.log("Obtener todos los virus: ", $get_viruses());
        // Obtener todos los virus (solo nombres): 
        console.log("Obtener todos los virus (solo nombres): ", $get_viruses_only_names());
        // Obtener la CANTIDAD de virus: 
        console.log("Obtener la CANTIDAD de virus: ", $get_viruses().length);

        const ruleta = document.getElementById("ruleta");
        const name_input = document.getElementById("name_input");
        const img_url_input = document.getElementById("img_url_input");
        const biography_input = document.getElementById("biography_input");
        const origin_input = document.getElementById("origin_input");
        const new_virus_and_save = document.getElementById("new_virus_and_save");
        var current_virus_name = "";
        var current_virus_index = 0;

        var flag_status_new_virus_and_save = "new";

        function new_virus_and_save_action() {
            if (flag_status_new_virus_and_save == "new") {
                flag_status_new_virus_and_save = "save";
                new_virus_and_save.innerHTML  = "Guardar";

                name_input.value = "";
                img_url_input.value = "";
                biography_input.value = "";
                origin_input.value = "";
                set_edition_mode(true, true);
            }
            else {
                flag_status_new_virus_and_save = "new";
                new_virus_and_save.innerHTML  = "Nuevo";
                attempt_to_add = $add_virus(name_input.value, img_url_input.value, biography_input.value, origin_input.value);
                console.log(attempt_to_add);
                if (attempt_to_add[0] == -1) { // already exist     
                    name_input.value = "";
                    alert(attempt_to_add[1]);
                }
                if (attempt_to_add[0] == -2) { // you need to pass the name at least    
                    alert(attempt_to_add[1]);
                }
                if (attempt_to_add[0] == 0) { // success   
                    alert(attempt_to_add[1]);
                    var viruses_length = $get_viruses_only_names().length;
                    var last_virus = $get_viruses()[viruses_length-1];
                    set_values_in_inputs(last_virus["name"], last_virus["img_url"], last_virus["biography"], last_virus["origin"]);
                    update_ruleta(viruses_length);
                    set_edition_mode(false, false);
                    current_virus_name = last_virus["name"];
                    current_virus_index = viruses_length -1;
                }
            }
        }
        function set_edition_mode(mode, mode_for_name=false){
            mode = !mode;
            mode_for_name = !mode_for_name;
            name_input.disabled = mode_for_name;
            img_url_input.disabled = mode;
            biography_input.disabled = mode;
            origin_input.disabled = mode;
        }

        function update_ruleta(position){
            ruleta.innerHTML = position + " de " + $get_viruses_only_names().length;
        }

        function set_values_in_inputs(value_for_name="", value_for_img_url="", value_for_biography="", value_for_origin="") {
            name_input.value = value_for_name;
            img_url_input.value = value_for_img_url;
            biography_input.value = value_for_biography;
            origin_input.value = value_for_origin;
        }

        function go_to_first() {
            var viruses_length = $get_viruses_only_names().length;
            if (viruses_length == 0) {
                set_values_in_inputs("", "", "", "")
                return;
            }
            var last_virus = $get_viruses()[0];
            set_values_in_inputs(last_virus["name"], last_virus["img_url"], last_virus["biography"], last_virus["origin"]);
            set_edition_mode(false, false);
            current_virus_name = last_virus["name"];
            current_virus_index = 0;
            update_ruleta(1);
        }

        function go_to_last() {
            var viruses_length = $get_viruses_only_names().length;
            if (viruses_length == 0) {
                set_values_in_inputs("", "", "", "")
                update_ruleta(0);
                return;
            }
            var last_virus = $get_viruses()[viruses_length-1];
            set_values_in_inputs(last_virus["name"], last_virus["img_url"], last_virus["biography"], last_virus["origin"]);
            set_edition_mode(false, false);
            current_virus_name = last_virus["name"];
            current_virus_index = viruses_length -1;
            update_ruleta(viruses_length);
        }

        function go_to_next() {
            var viruses_length = $get_viruses_only_names().length;
            if (viruses_length == 0 || current_virus_index > viruses_length-2)
                return;
            current_virus_index++;
            var last_virus = $get_viruses()[current_virus_index];
            current_virus_name = last_virus["name"];
            set_values_in_inputs(last_virus["name"], last_virus["img_url"], last_virus["biography"], last_virus["origin"]);
            set_edition_mode(false, false);
            update_ruleta(current_virus_index+1);
        }

        function go_to_previous() {
            var viruses_length = $get_viruses_only_names().length;
            if (viruses_length == 0 || current_virus_index < 1)
                return;
            current_virus_index--;
            var last_virus = $get_viruses()[current_virus_index];
            current_virus_name = last_virus["name"];
            set_values_in_inputs(last_virus["name"], last_virus["img_url"], last_virus["biography"], last_virus["origin"]);
            set_edition_mode(false, false);
            update_ruleta(current_virus_index+1);
        }

        function delete_current_virus(){
            if ($get_viruses_only_names().length == 0) {
                alert("Ya no hay virus en la base de datos");
                update_ruleta(0);
                current_virus_index = 0;
                current_virus_name = "";
                return;
            }
            current_virus_name = $get_viruses_only_names()[current_virus_index];
            current_virus_index--;
            if (current_virus_index < 0) {
                current_virus_index = 0;
            }
            
            $delete_virus(current_virus_name);
            go_to_first();
            if ($get_viruses_only_names().length == 0) {
                alert("Ya no hay virus en la base de datos");
                update_ruleta(0);
                current_virus_index = 0;
                current_virus_name = "";
                return;
            }
            console.log($get_viruses())

        }
        
        if ($get_viruses_only_names().length > 0) {
            go_to_first();
        }
        else {
            set_edition_mode(false, false);
            set_values_in_inputs();
            update_ruleta(0);
        }
    </script>
</body>
</html>