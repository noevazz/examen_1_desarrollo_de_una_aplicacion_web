<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen 1</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>

    <div class="container">
        <h1>Captura de registros</h1>
        <div class="row">
            <div class="col-sm-6 col-md-6 col-lg-6">
                <div class="form-group">
                    
                    <h2 class="text-center"><strong id="ruleta">0 de 0</strong></h2>

                    <label for="name">Nombre del virus</label> <br>
                    <input class="" type="text" id="name_input">
                    <br>
                    
                    <label for="img_url">URL de la imagen</label> <br>
                    <input class="" type="text" id="img_url_input">
                    <br>
                    
                    <label for="biography">Biografia</label> <br>
                    <input class="" type="text" id="biography_input">
                    <br>

                    <label for="origin">Origen</label> <br>
                    <input class="" type="text" id="origin_input">
                    <br> <br>
                    <button type="button" class="btn btn-outline-dark mb-1" id="new_virus_and_save" onclick="new_virus_and_save_action()">Nuevo</button>
                    <button type="button" class="btn btn-outline-dark mb-1" id="edit" onclick="edit_current_virus()">Editar</button>
                    <button type="button" class="btn btn-outline-dark mb-1" id="delete" onclick="delete_current_virus()">Eliminar</button>
                    <br>
                    <button type="button" class="btn btn-outline-dark mb-1" id="first" onclick="go_to_first()">Primero</button>
                    <button type="button" class="btn btn-outline-dark mb-1" id="next" onclick="go_to_next()">Siguiente</button>
                    <button type="button" class="btn btn-outline-dark mb-1" id="previous" onclick="go_to_previous()">Anterior</button>
                    <button type="button" class="btn btn-outline-dark mb-1" id="last" onclick="go_to_last()">Último</button>
                    <br>
                    <div class="btn-group">
                        <button id="search_field" type="button" class="btn btn-outline-dark dropdown-toggle" data-toggle="dropdown">
                        Campo
                        </button>
                        <div class="dropdown-menu">
                        <a id="name_search" class="dropdown-item" href="#" onclick="set_field(this)">Nombre</a>
                        <a id="img_url_search" class="dropdown-item" href="#" onclick="set_field(this)">URL</a>
                        <a id="biography_search" class="dropdown-item" href="#" onclick="set_field(this)">Biografia</a>
                        <a id="origin_search" class="dropdown-item" href="#" onclick="set_field(this)">Origen</a>
                        </div>
                    </div>
                    <input class="" type="text" id="search_text">
                    <button type="button" class="btn btn-outline-dark mb-1" id="search_button" onclick="search_this()">Buscar</button>

                </div>
            </div>
            <div class="col-sm-6 col-md-6 col-lg-6">
                <img id="image" src="" alt="Imagen no disponible" style="max-height: 200px;">
            </div>
        </div>
    </div>
    <div class="container">
        <h2>Requisitos del examen</h2>
        <div class="list-group">
            <li class="list-group-item list-group-item-action">
            ✅ I. Al presionar el botón de Nuevo se deben de limpiar todos los campos, y
            cambiar el botón a Guardar, cuando el botón sea Guardar agregar el registro
            y mostrarlo en pantalla (Siempre será el último registro), además de actualizar
            el estatus de la barra que indica en que registro se esta del total de registros, y
            cambiar de nuevo el botón para que diga Nuevo.
            
            <li class="list-group-item list-group-item-action">
            ✅ II. El botón de Editar te permite al presionarlo poner en edición el registro y
            cambiar el botón de Editar a Guardar, si presionas el botón de edición cuando
            esta en el modo de Guardar debe hacer el cambio en el registro que se esta
            editando, y regresar el botón a la vista de Editar, claro poniendo todos los
            campos en modo readonly par que no se puedan modificar.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ III. El botón de Eliminar elimina el registro donde estas posicionado, el que se
            muestra en pantalla.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ IV. El botón Primero se va al primer registro.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ V. El botón Siguiente se va al siguiente registro en el vector, siempre y cuando
            no se encuentre ya en el último.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ VI. El botón Anterior se va al registro anterior registro en el vector, siempre y
            cuando no se encuentre ya en el primero.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ VII. El botón de Ultimo se va al ultimo registro que se encuentra en el vector.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ VIII. En el botón de Buscar hay que seleccionar de la lista en cual campo se desea
            buscar, siguiente introducir el texto a buscar en ese campo, si lo encuentra
            posicionarse en el primero que encontró con ese contenido encontrado en ese
            campo, si no indicar que no se encontró información alguna.
            </li>

            <li class="list-group-item list-group-item-action">
            ✅ IX. Con la función JSON.stringify() convierte todo el vector en una cadena y
            guárdalo en utilizando los métodos de localstorage, y con JSON.parse()
            cargarlo de localstorage y conviértelo a vector de objetos de nuevo, Con la
            finalidad de que queden guardados todos los registros y poderlos recuperar
            también.
            </li>
        </div>
    </div>

    <script src="./web_storage_code.js"></script>
    <script>
        
        
        for (v of $get_viruses_only_names()){
            console.log(delete_virus(v));
            console.log("nombre ", v)
        }
        $add_virus(name="Cólera",
		img_url = "https://img.playbuzz.com/image/upload/ar_1.3333333333333333,c_crop/q_auto:good,f_auto,fl_lossy,w_640,c_limit,dpr_2.5/v1584801526/ganemwfg1xjsw14e1eww.jpg",
		biography ="El cólera es una enfermedad infecto-contagiosa intestinal aguda o crónica, provocada por los serotipos O1 y O139 de la bacteria Vibrio cholerae",
		origin = "Ríos indios Ganges y Brahmaputra");

        $add_virus(name="Gripe de Hong Kong",
		img_url = "https://static2.abc.es/media/historia/2020/03/05/asia-suecia-kVL--1200x630@abc.jpg",
		biography ="",
		origin = "Hong Kong");

        $add_virus(name="Gripe de Rusa",
		img_url = "https://ichef.bbci.co.uk/news/640/cpsprodpb/1742C/production/_112867259_gettyimages-152237642.jpg",
		biography ="",
		origin = "Rusia");

        $add_virus(name="H2N2",
		img_url = "https://cdni.rt.com/actualidad/public_images/2015.10/article/r/1104/90/jpeg/560d3b2cc4618855198b45bd.jpg",
		biography ="En febrero de 1957, un nuevo virus de la influenza A (H2N2) apareció en el este de Asia, desencadenando una pandemia Influenza asiática",
		origin = "Singapur");

        $add_virus(name="Peste antonina",
		img_url = "https://estaticos-cdn.sport.es/clip/8f9bbbbd-3db2-4166-92b4-74ad9c7d3232_alta-libre-aspect-ratio_default_0.jpg",
		biography ="",
		origin = "");

        $add_virus(name="Plaga de Justiniano",
		img_url = "https://imagenes.elpais.com/resizer/Ed0H6xwxKSuWFWTOaDagen-epuQ=/1500x0/arc-anglerfish-eu-central-1-prod-prisa.s3.amazonaws.com/public/AATWVMDSOL6MNEG47E2EXERAAU.jpg",
		biography ="",
		origin = "");

        $add_virus(name="Gripe española",
		img_url = "https://gacetamedica.com/wp-content/uploads/2020/02/The-Spanish-Influenza.-Emergency-military-hospital-during-influenza-epidemic-Camp-Funston-Kansas-United-States_National-Museum-of-Health-and-Medicine-1-1.jpg",
		biography ="",
		origin = "");

        $add_virus(name="Viruela ",
		img_url = "https://www.lavanguardia.com/files/image_449_220/uploads/2019/06/30/5fa53008f40be.jpeg",
		biography ="La viruela es una de las enfermedades más mortales que conocen los humanos, y también es la única enfermedad que ha sido erradicada con la vacunación.",
		origin = "Egipto");

        $add_virus(name="Ébola",
		img_url = "https://sersaludables.org/wp-content/uploads/2020/02/Cuatro-pa%C3%ADses-de-%C3%81frica-se-protegen-contra-el-%C3%A9bola.jpg",
		biography ="El ébola no se transmite por el aire, sino a través del contacto con animales infectados o por el contacto de fluidos corporales de personas.",
		origin = "África Occidental");

		$add_virus(name = "Malaria",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/malaria.jpg?itok=5Z0ih-at",
		biography ="Se transmite por la picadura del mosquito Anopheles.",
		origin = "África subsahariana");

		$add_virus(name = "Dengue",
		img_url = "https://1.bp.blogspot.com/-1v435OIpY9k/XcagBcUkg4I/AAAAAAAAHzY/MFjOTomfXOIGhYOUu6ypccTQhOZNiSanwCLcBGAsYHQ/s1600/dengue.jpg",
		biography ="Se trata de una infección vírica transmitida por mosquitos que se presenta en los climas tropicales y subtropicales de todo el planeta, sobre todo en las zonas urbanas y semiurbanas.",
		origin = "África subsahariana");

		$add_virus(name = "Sarampión",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/rf187423_077961_web_0.jpg?itok=PwAa9GjT",
		biography ="Enfermedad infecciosa y contagiosa, causada por un virus, que se caracteriza por la aparición de pequeñas manchas rojas en la piel, fiebre alta y síntomas catarrales; generalmente, se padece durante la infancia.",
		origin ="Colima");

		$add_virus(name = "Sarampión2",
		img_url = "https://eacnur.org/files/styles/two_columns_photo_info/public/paragraph/two_columns_foto_info/rf187423_077961_web_0.jpg?itok=PwAa9GjT",
		biography = "Enfermedad infecciosa y contagiosa, causada por un virus, que se caracteriza por la aparición de pequeñas manchas rojas en la piel, fiebre alta y síntomas catarrales; generalmente, se padece durante la infancia.",
		origin = "Colima");

		$add_virus(name = "SIDA",
		img_url = "https://medicinaysaludpublica.com/wp-content/uploads/2018/11/vih-sida-por-que-no-te-vas-a-contagiar-con-un-beso-y-otros-7-mitos-sobre-el-virus-y-la-enfermedad-1200x919.jpg",
		biography = "El virus se transmite por vía sexual, a través de transfusiones de sangre contaminada, por el uso compartido de materiales quirúrgicos contaminados, o de madre a hijo durante el embarazo, el parto o la lactancia.",
		origin = "África");

		$add_virus(name = "COVID-19",
		img_url = "https://www.coyoacan.cdmx.gob.mx/imgcovid/covid4.jpg",
		biography = "El coronavirus es un grupo de virus que causan enfermedades que van desde el resfriado común hasta enfermedades más graves.",
		origin = "Wuhan, en China");


        // Obtener todos los virus: 
        console.log("Obtener todos los virus: ", $get_viruses());
        // Obtener todos los virus (solo nombres): 
        console.log("Obtener todos los virus (solo nombres): ", $get_viruses_only_names());
        // Obtener la CANTIDAD de virus: 
        console.log("Obtener la CANTIDAD de virus: ", $get_viruses().length);

        const ruleta = document.getElementById("ruleta");
        const name_input = document.getElementById("name_input");
        const img_url_input = document.getElementById("img_url_input");
        const biography_input = document.getElementById("biography_input");
        const origin_input = document.getElementById("origin_input");
        const new_virus_and_save = document.getElementById("new_virus_and_save");
        const delete_button = document.getElementById("edit");
        const search_button = document.getElementById("search_button");
        const search_text = document.getElementById("search_text");
        const image = document.getElementById("image");

        var current_virus_name = "";
        var current_virus_index = -1;

        var flag_status_new_virus_and_save = "new";

        function new_virus_and_save_action() {
            if (flag_status_new_virus_and_save == "new") {
                flag_status_new_virus_and_save = "save";
                new_virus_and_save.innerHTML  = "Guardar";

                delete_button.innerHTML = "Edit";

                name_input.value = "";
                img_url_input.value = "";
                biography_input.value = "";
                origin_input.value = "";
                set_edition_mode(true, true);
            }
            else {
                
                attempt_to_add = $add_virus(name_input.value, img_url_input.value, biography_input.value, origin_input.value);
                console.log(attempt_to_add);
                if (attempt_to_add[0] == -1) { // already exist     
                    name_input.value = "";
                    alert(attempt_to_add[1]);
                    new_virus_and_save.innerHTML  = "Nuevo";
                    flag_status_new_virus_and_save = "new"
                    go_to_first();
                }
                if (attempt_to_add[0] == -2) { // you need to pass the name at least    
                    alert(attempt_to_add[1]);
                    new_virus_and_save.innerHTML  = "Nuevo";
                    flag_status_new_virus_and_save = "new"
                    go_to_first();
                }
                if (attempt_to_add[0] == 0) { // success   
                    flag_status_new_virus_and_save = "new";
                    new_virus_and_save.innerHTML  = "Nuevo";
                    alert(attempt_to_add[1]);
                    var viruses_length = $get_viruses_only_names().length;
                    var last_virus = $get_viruses()[viruses_length-1];
                    set_values_in_inputs(last_virus["name"], last_virus["img_url"], last_virus["biography"], last_virus["origin"]);
                    update_ruleta(viruses_length);
                    set_edition_mode(false, false);
                    image.src = ast_virus["img_url"];
                }
                
            }
        }
        function set_edition_mode(mode, mode_for_name=false){
            mode = !mode;
            mode_for_name = !mode_for_name;
            name_input.disabled = mode_for_name;
            img_url_input.disabled = mode;
            biography_input.disabled = mode;
            origin_input.disabled = mode;
        }

        function update_ruleta(position){
            ruleta.innerHTML = position + " de " + $get_viruses_only_names().length;
        }

        function set_values_in_inputs(value_for_name="", value_for_img_url="", value_for_biography="", value_for_origin="") {
            name_input.value = value_for_name;
            img_url_input.value = value_for_img_url;
            biography_input.value = value_for_biography;
            origin_input.value = value_for_origin;
            image.src = value_for_img_url;
        }

        function go_to_first() {
            flag_edit_virus = "edit";
            delete_button.innerHTML = "Editar";
            
            flag_status_new_virus_and_save = "new";
            new_virus_and_save.innerHTML  = "Nuevo"

            var viruses_length = $get_viruses_only_names().length;
            if (viruses_length == 0) {
                set_values_in_inputs("", "", "", "")
                return;
            }
            if (current_virus_index == 0) {
                alert("Ya estas al inicio");
            }

            var first_virus = $get_viruses()[0];
            set_values_in_inputs(first_virus["name"], first_virus["img_url"], first_virus["biography"], first_virus["origin"]);
            set_edition_mode(false, false);
            current_virus_name = first_virus["name"];
            current_virus_index = 0;
            update_ruleta(1);
            image.src = first_virus["img_url"];
        }

        function go_to_last() {
            flag_edit_virus = "edit";
            delete_button.innerHTML = "Editar";

            flag_status_new_virus_and_save = "new";
            new_virus_and_save.innerHTML  = "Nuevo"
            var viruses_length = $get_viruses_only_names().length;
            if (viruses_length == 0) {
                set_values_in_inputs("", "", "", "")
                update_ruleta(0);
                return;
            }
            if (current_virus_index == $get_viruses_only_names().length-1) {
                alert("Ya estas al final");
            }

            var last_virus = $get_viruses()[viruses_length-1];
            set_values_in_inputs(last_virus["name"], last_virus["img_url"], last_virus["biography"], last_virus["origin"]);
            set_edition_mode(false, false);
            current_virus_name = last_virus["name"];
            current_virus_index = viruses_length -1;
            update_ruleta(viruses_length);
            image.src = last_virus["img_url"];
        }

        function go_to_next() {
            flag_edit_virus = "edit";
            delete_button.innerHTML = "Editar";

            flag_status_new_virus_and_save = "new";
            new_virus_and_save.innerHTML  = "Nuevo";
            var viruses_length = $get_viruses_only_names().length;
            if (viruses_length == 0)
                return;
            if (current_virus_index == $get_viruses_only_names().length-1)
                alert("Ya estas al final");
            else
                current_virus_index++;
            var next_virus = $get_viruses()[current_virus_index];
            current_virus_name = next_virus["name"];
            set_values_in_inputs(next_virus["name"], next_virus["img_url"], next_virus["biography"], next_virus["origin"]);
            set_edition_mode(false, false);
            update_ruleta(current_virus_index+1);
            image.src = next_virus["img_url"];
        }

        function go_to_previous() {
            flag_edit_virus = "edit";
            delete_button.innerHTML = "Editar";

            flag_status_new_virus_and_save = "new";
            new_virus_and_save.innerHTML  = "Nuevo";
            var viruses_length = $get_viruses_only_names().length;
            if (viruses_length == 0)
                return;
            if (current_virus_index == 0) 
                alert("Ya estas al inicio");
            else
                current_virus_index--;
            var previous_virus = $get_viruses()[current_virus_index];
            current_virus_name = previous_virus["name"];
            set_values_in_inputs(previous_virus["name"], previous_virus["img_url"], previous_virus["biography"], previous_virus["origin"]);
            set_edition_mode(false, false);
            update_ruleta(current_virus_index+1);
            image.src = previous_virus["img_url"];

        }

        function delete_current_virus(){
            flag_edit_virus = "edit";
            delete_button.innerHTML = "Editar";
            if (flag_status_new_virus_and_save == "save"){
                alert("Ups!, estas añadiendo un virus");
                return;
            }
            if ($get_viruses_only_names().length == 0) {
                alert("Ya no hay virus en la base de datos");
                update_ruleta(0);
                current_virus_index = 0;
                current_virus_name = "";
                return;
            }
            flag_status_new_virus_and_save = "new";
            new_virus_and_save.innerHTML  = "Nuevo";
            current_virus_name = $get_viruses_only_names()[current_virus_index];
            current_virus_index--;
            if (current_virus_index < 0) {
                current_virus_index = 0;
            }
            
            $delete_virus(current_virus_name);
            go_to_first();
            if ($get_viruses_only_names().length == 0) {
                alert("Ya no hay virus en la base de datos");
                update_ruleta(0);
                current_virus_index = 0;
                current_virus_name = "";
                return;
            }
            console.log($get_viruses())

        }

        var flag_edit_virus = "edit";
        function edit_current_virus(){
            if (flag_status_new_virus_and_save == "save"){
                alert("Ups!, estas añadiendo un virus");
                return;
            }
            if (flag_edit_virus == "edit") {
                flag_edit_virus = "save";
                set_edition_mode(true, false)
                delete_button.innerHTML = "Guardar";
            }
            else {
                var r = $update_virus(current_virus_name, img_url_input.value, biography_input.value, origin_input.value)
                image.src = img_url_input.value;
                alert(r[1]);
                set_edition_mode(false, false)
                flag_edit_virus = "edit";
                delete_button.innerHTML = "Editar";
                image.src = img_url_input.value;
            }
        }
        
        var search_option = "";
        function set_field(e) {
            console.log(e.id);
            var update_search_field_with_this = "";
            switch (e.id){
                case "name_search": 
                    update_search_field_with_this = "Nombre";
                    search_option = "name";
                    break;
                case "img_url_search": 
                    update_search_field_with_this = "URL";
                    search_option = "img_url";
                    break;
                case "biography_search": 
                    update_search_field_with_this = "Biografia";
                    search_option = "biography";
                    break;
                case "origin_search": 
                    update_search_field_with_this = "Origen";
                    search_option = "origin";
                    break;
            }
            document.getElementById("search_field").innerHTML = update_search_field_with_this
        }

        function search_this() {
            flag_status_new_virus_and_save = "new";
            new_virus_and_save.innerHTML  = "Nuevo"
            if ($get_viruses_only_names().length == 0) {
                alert("Ups, no hay virus en la base de datos para buscar");
                return;
            }
            if (search_option == "") {
                alert ("Selecciona una opción")
                return;
            }
                
            var counter_v = 0
            for (v of $get_viruses()){
                if (v[search_option] == search_text.value){
                    current_virus_index = counter_v;
                    current_virus_name = v["name"];
                    set_values_in_inputs(v["name"], v["img_url"], v["biography"], v["origin"]);
                    image.src = v["img_url"];
                    alert("Yei!, se encontro un resultado");
                    update_ruleta(counter_v+1)
                    return;
                }
                counter_v++;
            }
            alert("No se encontro nada")
        }
        
        if ($get_viruses_only_names().length > 0) {
            go_to_first();
        }
        else {
            set_edition_mode(false, false);
            set_values_in_inputs();
            update_ruleta(0);
        }
    </script>
</body>
</html>